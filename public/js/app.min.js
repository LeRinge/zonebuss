function updateSalesChart(e,t){if(e=="salesChart"){dataGet=data}else{dataGet=dataCompare}dataGet.date=t["label"];var n=e=="salesChart"?true:false;$.ajaxq("QueueCharts",{url:"api/BBVA/consumptionPattern",dataType:"json",type:"post",data:dataGet,success:function(e){if(n){updateChartWeek(e,"salesChartweek")}else{updateChartWeek(e,"salesChartweekCompare")}}})}function updateChartWeek(e,t){var n;var r=[];e.forEach(function(e){if(e["num_payments"]===undefined){r.push(0)}else{r.push(e["num_payments"])}});if(t=="salesChartweek"){for(n=0;n<7;n++){salesChartweek.datasets[0].points[n].value=r[n]}r.forEach(function(e){});salesChartweek.update();$("#diaWeek").text(e[0]["month"]);$("#diaWeek").css("color","red")}else{for(n=0;n<7;n++){salesChartweekCompare.datasets[0].points[n].value=r[n]}salesChartweekCompare.update();$("#diaWeekCompare").text(e[0]["month"]);$("#diaWeekCompare").css("color","red")}}function updateInfoGender(e,t){if(t=="genderChart"){$("#RangoH").text(e["M"]["Range"]);$("#AvgH").text(e["M"]["Avg"]);$("#RangoF").text(e["F"]["Range"]);$("#AvgF").text(e["F"]["Avg"]);$("#mesGender").text(e["M"]["month"]);$("#mesGender").css("color","red")}else{$("#RangoHCompare").text(e["M"]["Range"]);$("#AvgHCompare").text(e["M"]["Avg"]);$("#RangoFCompare").text(e["F"]["Range"]);$("#AvgFCompare").text(e["F"]["Avg"]);$("#mesGenderCompare").text(e["M"]["month"]);$("#mesGenderCompare").css("color","red")}}function updateChartGender(e,t){if(t=="genderChart"){doughnutgenderChart.segments[0].value=e["M"]["percentage"];doughnutgenderChart.segments[1].value=e["F"]["percentage"];doughnutgenderChart.update();var n=doughnutgenderChart.generateLegend();$("#doughnutgenderChart_legend").innerHTML=n}else{doughnutgenderChartCompare.segments[0].value=e["M"]["percentage"];doughnutgenderChartCompare.segments[1].value=e["F"]["percentage"];doughnutgenderChartCompare.update();var n=doughnutgenderChartCompare.generateLegend();$("#doughnutgenderChartCompare_legend").innerHTML=n}}function updateSalesChartGender(e,t){if(e=="genderChart"){dataGet=data}else{dataGet=dataCompare}dataGet.date=t["label"];$.ajaxq("QueueCharts",{url:"api/BBVA/cardCube",dataType:"json",type:"post",data:dataGet,success:function(t){if(e=="genderChart"){updateInfoGender(t,"genderChart");updateChartGender(t,"genderChart")}else{updateInfoGender(t,"genderChartCompare");updateChartGender(t,"genderChartCompare")}}})}function ShowChartsGender(e){var t=e=="weekChart"?true:false;var n=[{value:5,color:"#16A6ED",label:"Hombres"},{value:5,color:"#E80085",label:"Mujeres"}];if(e=="genderChart"){dataGet=data;var r=$("#genderChart").get(0).getContext("2d");doughnutgenderChart=(new Chart(r)).Doughnut(n,{animationEasing:"easeOutBounce",legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'})}else{dataGet=dataCompare;var i=$("#genderChartCompare").get(0).getContext("2d");doughnutgenderChartCompare=(new Chart(i)).Doughnut(n,{animationEasing:"easeOutBounce",legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'})}dataGet.date="Nov";$.ajaxq("QueueCharts",{url:"api/BBVA/cardCube",dataType:"json",type:"post",data:dataGet,success:function(t){if(e=="genderChart"){updateInfoGender(t,"genderChart");updateChartGender(t,"genderChart")}else{updateInfoGender(t,"genderChartCompare");updateChartGender(t,"genderChartCompare")}}})}function ShowChartsWeek(e){var t=e=="weekChart"?true:false;var n={labels:["Lun","Mar","Mie","Jue","Vie","Sab","Dom"],datasets:[{label:"weekChart",fillColor:"rgba(132,222,197,0.5)",strokeColor:"#84DEC5",pointColor:"#84DEC5",pointStrokeColor:"#84DEC5",pointHighlightFill:"#000",pointHighlightStroke:"#000",data:[0,0,0,0,0,0,0]}]};if(e=="weekChart"){dataGet=data;dataGet.weekChart=true;var r=$("#weekChart").get(0).getContext("2d");salesChartweek=(new Chart(r)).Line(n,{bezierCurve:true,scaleGridLineWidth:5,pointDotRadius:7,datasetFill:false})}else{dataGet=dataCompare;dataGet.weekChart=false;var i=$("#weekChartCompare").get(0).getContext("2d");salesChartweekCompare=(new Chart(i)).Line(n,{bezierCurve:true,scaleGridLineWidth:5,pointDotRadius:7,datasetFill:false})}dataGet.date="Nov";$.ajaxq("QueueCharts",{url:"api/BBVA/consumptionPattern",dataType:"json",type:"post",data:dataGet,success:function(e){if(dataGet.weekChart){updateChartWeek(e,"salesChartweek")}else{updateChartWeek(e,"salesChartweekCompare")}}})}function showChartWeek(){}function showInfoPlace(e,t){if(t=="mapC"){$("#direccion").text(e["direccion"])}else{$("#direccionCompare").text(e["direccion"])}}function showInfoBBVA(e,t){var n=[];e.forEach(function(e){if(e["num_payments"]===undefined){n.push(0)}else{n.push(e["num_payments"])}});var r={labels:["Nov","Dic","Ene","Feb","Mar","Abr"],datasets:[{label:"My First dataset",fillColor:"rgba(132,222,197,0.5)",strokeColor:"#84DEC5",pointColor:"#84DEC5",pointStrokeColor:"#84DEC5",pointHighlightFill:"#000",pointHighlightStroke:"#000",data:n}]};var i=Math.max.apply(Math,n);var s=i>1e3?1e3:100;var o=i*1.25/s;if(t=="salesChart"){var u=$("#salesChart").get(0).getContext("2d");chartSales=(new Chart(u)).Line(r,{bezierCurve:true,scaleGridLineWidth:5,pointDotRadius:7,scaleOverride:true,scaleSteps:o,scaleStepWidth:s,scaleStartValue:0,datasetFill:false});var a=document.getElementById("salesChart");a.onclick=function(e){var t=chartSales.getPointsAtEvent(e);updateSalesChartGender("genderChart",t[0]);updateSalesChart("salesChart",t[0])}}else{var f=$("#salesChartCompare").get(0).getContext("2d");chartSalesCompare=(new Chart(f)).Line(r,{bezierCurve:true,scaleGridLineWidth:5,pointDotRadius:7,scaleOverride:true,scaleSteps:o,scaleStepWidth:s,scaleStartValue:0,datasetFill:false});var l=document.getElementById("salesChartCompare");l.onclick=function(e){var t=chartSalesCompare.getPointsAtEvent(e);updateSalesChartGender("genderChartCompare",t[0]);updateSalesChart("salesChartweek",t[0])}}}function showInfoMap(e,t){if(t=="mapC"){initializeMapCompetencia("mapC");mapC.setView(new L.LatLng(e[0].latitude,e[0].longitude),15);setTimeout(function(){mapC.invalidateSize()},1500);$.each(e,function(t){if(t==0){drawMarker(e[t].name,e[t].latitude,e[t].longitude,"mapC","84DEC5");$("#competidores").text(e[t]["competitors"]+" competidores");$("#competidores").css("color","red")}else{drawMarker(e[t].name,e[t].latitude,e[t].longitude,"mapC","FF0000")}})}else{initializeMapCompetencia("mapCompare");mapCompare.setView(new L.LatLng(e[0].latitude,e[0].longitude),15);setTimeout(function(){mapCompare.invalidateSize()},1500);$.each(e,function(t){if(t==0){drawMarker(e[t].name,e[t].latitude,e[t].longitude,"mapCompare","84DEC5");$("#competidoresCompare").text(e[t]["competitors"]+" competidores");$("#competidoresCompare").css("color","red")}else{drawMarker(e[t].name,e[t].latitude,e[t].longitude,"mapCompare","FF0000")}})}}function drawMarker(e,t,n,r,i,s){if(r=="mapC"){marker=L.marker([t,n],{icon:L.mapbox.marker.icon({"marker-color":i})});marker.bindPopup(e);marker.addTo(mapC)}else{marker=L.marker([t,n],{icon:L.mapbox.marker.icon({"marker-color":i})});marker.bindPopup(e);marker.addTo(mapCompare)}}function SendInfoSetup(e){var t=$(".icon.active").attr("id");var n;var r;var i=e=="place"?true:false;if(e=="place"){n=locatization.lat+","+locatization.lng;data={category:t,lat:locatization.lat,lng:locatization.lng,lat_lng:n};r=data}else{n=locatizationCompare.lat+","+locatizationCompare.lng;dataCompare={category:t,lat:locatizationCompare.lat,lng:locatizationCompare.lng,lat_lng:n};r=dataCompare}$.ajaxq("QueueAPIS",{url:"api/Google/geocode",dataType:"json",type:"post",data:r,success:function(e){if(i){showInfoPlace(e,"mapC")}else{showInfoPlace(e,"mapCompare")}}});$.ajaxq("QueueAPIS",{url:"api/Factual/places",dataType:"json",type:"post",data:r,success:function(e){if(i){showInfoMap(e,"mapC")}else{showInfoMap(e,"mapCompare")}}});$.ajaxq("QueueAPIS",{url:"api/BBVA/paymentDistribution",dataType:"json",type:"post",data:r,success:function(e){if(i){showInfoBBVA(e,"salesChart");ShowChartsWeek("weekChart");ShowChartsGender("genderChart")}else{showInfoBBVA(e,"salesChartCompare");ShowChartsWeek("weekChartCompare");ShowChartsGender("genderChartCompare")}}});$("#myModal").modal("show")}function initializeButtons(){$(".icon.btn").on("click",function(){$(".icon.active").removeClass().addClass("icon btn btn-default btn-lg");$(this).removeClass();$(this).addClass("icon btn btn-primary btn-lg")})}function initializeFuelux(){$("#myWizard").wizard()}function initializeMapCompetencia(e){if(e=="mapC"){L.mapbox.accessToken="pk.eyJ1IjoibHUxenp6IiwiYSI6Imp0RnFuRm8ifQ.7oDrxlos9T1R3_RqKHyshQ";mapC=L.mapbox.map("mapC","examples.map-i86nkdio")}else{L.mapbox.accessToken="pk.eyJ1IjoibHUxenp6IiwiYSI6Imp0RnFuRm8ifQ.7oDrxlos9T1R3_RqKHyshQ";mapCompare=L.mapbox.map("mapCompare","examples.map-i86nkdio")}}function initializeMapBox(){L.mapbox.accessToken="pk.eyJ1IjoibHUxenp6IiwiYSI6Imp0RnFuRm8ifQ.7oDrxlos9T1R3_RqKHyshQ";map=L.mapbox.map("map","examples.map-i86nkdio").setView([19.412367888315664,-99.16139602661131],14);map.zoom=15;marker=L.marker([19.426367888315664,-99.16139602661131],{icon:L.mapbox.marker.icon({"marker-color":"84DEC5"}),draggable:true});markerCompare=L.marker([19.408882974361152,-99.1713960266113],{icon:L.mapbox.marker.icon({"marker-color":"84DEC5"}),draggable:true});marker.on("dragend",ondragend);marker.addTo(map);markerCompare.on("dragend",ondragend);markerCompare.addTo(map);ondragend();setTimeout(function(){map.invalidateSize()},400)}function ondragend(){locatization=marker.getLatLng();locatizationCompare=markerCompare.getLatLng()}var map;var locatization;var locatizationCompare;var marker;var markerCompare;var category;var myApp;var mapCompetencia;var markers;var chartSales;var chartSalesCompare;var salesChartweek;var salesChartweekCompare;var RadarChart;var RadarChartCompare;var doughnutgenderChart;var doughnutgenderChartCompare;var data;var dataCompare;var dataGet;$(document).ready(function(){initializeFuelux();initializeButtons();Chart.defaults.global.responsive=true;Chart.defaults.global.scaleFontColor="#fff";$("#myWizard").on("actionclicked.fu.wizard",function(e,t){if(t.step===1&&t.direction==="next"){initializeMapBox()}});$("#myWizard").on("finished.fu.wizard",function(e,t){SendInfoSetup("place");SendInfoSetup("placeCompare");$("#myWizard").wizard("destroy");$(".intro").hide();$("#charts").show();$("#myModal").modal("hide")})});myApp=myApp||function(){var e=$("#pleaseWaitDialog");return{showPleaseWait:function(){e.modal()},hidePleaseWait:function(){e.modal("hide")}}}()